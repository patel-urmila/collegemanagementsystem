{% extends "HodDashBoard.html" %}
{% block content %}
<h1>Manage Subject</h1>
<button data-subject-id="{{i.id}}"class="add-button btn btn-primary" data-toggle="modal" data-target="#exampleModal" id="span_course_name">Add Subject</button> 
    <table class="table">
        <thead class="thead-dark">
          <tr>
            <th scope="col">Subject ID</th>
            <th scope="col">Subject Name</th>
            <th></th>
            <th></th>
          </tr> 
        </thead>
        <tbody>
            {% for i in subject %}
                <tr>
                    <th scope="row">{{i.id}}</th>
                    <td><span id="spanSubNm{{i.id}}">{{i.subName}} </span><input id="SubNminput{{i.id}}" value="{{i.subName}}" hidden/></td>
                    <td>                
                        <button class="btn btn-warning" id='upadteSubdata{{i.id}}' onclick='updatesubject({{i.id}})' >Edit</button>
                        <button class="btn btn-primary" id='saveSubdata{{i.id}}' onclick='savesubjectdata({{i.id}})'hidden>Save</button>
                    </td>  
                    <td>
                        <button id="{{i.id}}" class="btn btn-danger" onclick='deletesubjectdata({{i.id}})'>Delete</button>
                    </td> 
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title fw-bold text-start" id="exampleModalLabel">Course Details</h4>
            </div>
            <div class="modal-body">
              <form>
                <div class="form-group">
                  <label for="recipient-name" class="col-form-label">Subject Name:</label>
                  <input type="text" class="form-control" id="floatingInputSubjectNm" placeholder="Enter Subject Name" name="Subjectnm">
                </div>
                <div class="form-group">
                  <label for="recipient-name" class="col-form-label">Course</label>
                  <input type="text" class="form-control" id="floatingInputCourseNm" placeholder="Enter Session Year" name="Coursenm">
                </div>
                <div class="form-group">
                  <label for="recipient-name" class="col-form-label">Teacher</label>
                  <input type="text" class="form-control" id="floatingInputTeacherNm" placeholder="Enter Session Year" name="teacherNm">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal" onclick='postsubjectdata()'>Submit</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      {% if flag %}
      <script>
        window.location.href = "/login/"
      </script>
      {% endif %}
    {% endblock content %}
    {% block js%}
    <script>
        console.log("hello-----")
        function updatesubject(e){
            document.getElementById("upadteSubdata"+e).hidden = true
            document.getElementById("spanSubNm"+e).hidden = true
            document.getElementById("saveSubdata"+e).removeAttribute("hidden");
            document.getElementById("SubNminput"+e).removeAttribute("hidden");
        }
    
        function savesubjectdata(e){
            console.log("here---")
            Subject = document.getElementById("SubNminput"+e).value;
            $.ajax({
                method: "patch",
                url: "/subject/"+e,
                headers: {
                    'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val()
                },
                data:{
                    'pk':e,
                    'subName': Subject,
                },
                success: function(){
                    console.log("--------success")
                    document.location = "/managesubject/"
                },
                error: function () {
                    console.log("error ---------")
                    document.location = "/managesubject/"
                   }
          });
        }
    
        function deletesubjectdata(e){
            $.ajax({
                method: "delete",
                url: "/subject/"+e,
                headers: {
                    'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val()
                },
                data:{
                    'pk':e,
                },
                success: function(){
                    document.location = "/managesubject/"
                },
                error: function () {
                    document.location = "/managesubject/"
                   }
          });
        }
    
        function postsubjectdata(){
            SubNm = document.getElementById("floatingInputSubjectNm").value;
            Course = document.getElementById("floatingInputCourseNm").value;
            Teacher = document.getElementById("floatingInputTeacherNm").value;
            $.ajax({
                method: "post",
                url: "/subject/",
                headers: {
                    'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val()
                },
                data:{
                    'subName': SubNm,
                    'course':Course,
                    'teacher':Teacher
                },
                success: function(){
                    console.log("-------success")
                    document.location = "/managesubject/"
                },
                error: function () {
                    console.log("error------")
                    document.location = "/managesubject/"
                   }
          });
        }
    </script>
    {% endblock js%}

